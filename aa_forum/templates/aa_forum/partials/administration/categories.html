{% load bootstrap %}
{% load i18n %}

<div class="row">
    <div class="col-md-6 col-md-push-6">
        <p>
            {% translate "Here you can create, modify and delete categories and boards. You also can change their order via drag and drop." %}
        </p>

        <p>
            <button class="btn btn-default" type="button" data-toggle="collapse" data-target="#collapseNewCategoryForm" aria-expanded="false" aria-controls="collapseNewCategoryForm">
                {% translate "Create New Category" %}
            </button>
        </p>

        <div class="collapse" id="collapseNewCategoryForm">
            <div class="well">
                <p>
                    {% translate "New categories will be added at the bottom of the category list. You can move them via drag and drop to a position of your liking." %}
                </p>

                <form action="{% url 'aa_forum:admin_category_create' %}" method="post">
                    <fieldset>
                        {% csrf_token %}

                        {{ new_category_form|bootstrap }}

                        <div class="form-group aa-forum-form-new-category text-right clearfix">
                            <button class="btn btn-primary" type="submit">{% translate 'Create Category' %}</button>
                        </div>
                    </fieldset>
                </form>
            </div>
        </div>
    </div>

    {% if category_loop %}
        <div class="col-md-6 col-md-pull-6">
            <script type="application/javascript">
                // categoriesWithBoards = (typeof categoriesWithBoards != 'undefined' && categoriesWithBoards instanceof Array) ? categoriesWithBoards : []
                let categoriesWithBoards = []

                aaForumAdminSettings['urls'] = {
                    categoryOrder: '{% url "aa_forum:admin_ajax_category_order" %}',
                    boardOrder: '{% url "aa_forum:admin_ajax_board_order" %}'
                }

                aaForumAdminSettings['form'] = {
                    csrfToken: '{{ csrf_token }}'
                }
            </script>

            <ul id="categories-sortable" class="categories-sortable">
                {% for category in category_loop %}
                    <li class="category-sortable ui-state-default ui-sortable" data-category-id="{{ category.category_obj.pk }}" data-position="{{ category.category_obj.order }}">
                        <div class="panel panel-default aa-forum-admin-panel-aa-forum-category">
                            <div class="panel-heading">
                                <div class="panel-title">
                                    {{ category.category_obj.name }}

                                    <div class="pull-right">
                                        <button class="btn btn-warning btn-xs" title="{% translate 'Edit Category' %}" data-toggle="collapse" data-target="#collapseEditCategory-{{ category.category_obj.pk }}" aria-expanded="false" aria-controls="collapseEditCategory-{{ category.category_obj.pk }}">
                                            <i class="fas fa-pencil-alt"></i>
                                        </button>

                                        <button class="btn btn-danger btn-xs"title="{% translate 'Delete Category' %}">
                                            <i class="far fa-trash-alt"></i>
                                        </button>

                                        <button class="aa-forum-admin-expand-collapse-category btn btn-default btn-xs collapsed" title="{% translate 'Expand/Collapse Category' %}" data-toggle="collapse" data-target="#collapseCategory-{{ category.category_obj.pk }}" aria-expanded="false" aria-controls="collapseCategory-{{ category.category_obj.pk }}">
                                            <i class="if-collapsed fas fa-expand-alt"></i>
                                            <i class="if-expanded fas fa-compress-alt"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="panel-body">
                                <div class="collapse" id="collapseEditCategory-{{ category.category_obj.pk }}">
                                    <div class="well">
                                        <p>
                                            {% translate "Changing the name of this category does not change its URL part. This will remain the same to not break any possible links into this category." %}
                                        </p>

                                        <form action="{% url 'aa_forum:admin_category_edit' category.category_obj.pk %}" method="post">
                                            <fieldset>
                                                {% csrf_token %}

                                                {{ category.category_forms.edit_category|bootstrap }}

                                                <div class="form-group aa-forum-form-new-category text-right clearfix">
                                                    <button class="btn btn-primary btn-sm" type="submit">{% translate 'Change Category' %}</button>
                                                </div>
                                            </fieldset>
                                        </form>
                                    </div>
                                </div>

                                <div class="collapse" id="collapseCategory-{{ category.category_obj.pk }}">
                                    <p>
                                        <button class="btn btn-default btn-sm" type="button" data-toggle="collapse" data-target="#collapseNewBoardForm-{{ category.category_obj.pk }}" aria-expanded="false" aria-controls="collapseNewBoardForm-{{ category.category_obj.pk }}">
                                            {% translate "New Board" %}
                                        </button>
                                    </p>

                                    <div class="collapse" id="collapseNewBoardForm-{{ category.category_obj.pk }}">
                                        <div class="well">
                                            <p>
                                                {% translate "New boards will be added at the bottom of the board list for this category. You can move them via drag and drop to a position of your liking." %}
                                            </p>

                                            <form action="{% url 'aa_forum:admin_board_create' category.category_obj.pk %}" method="post">
                                                <fieldset>
                                                    {% csrf_token %}

                                                    {{ category.category_forms.new_board|bootstrap }}

                                                    <div class="form-group aa-forum-form-new-category text-right clearfix">
                                                        <button class="btn btn-primary btn-sm" type="submit">{% translate 'Create Board' %}</button>
                                                    </div>
                                                </fieldset>
                                            </form>
                                        </div>
                                    </div>

                                    {% if category.boards %}
                                        <ul id="boards-sortable-category-{{ category.category_obj.pk }}" class="boards-sortable">
                                            {% for board in category.boards %}
                                                <li class="board-sortable ui-state-default ui-sortable" data-board-id="{{ board.board_obj.pk }}" data-position="{{ board.board_obj.order }}">
                                                    <div class="aa-forum-admin-board-name clearfix">
                                                        {{ board.board_obj.name }}

                                                        <div class="pull-right">
                                                            <button class="btn btn-warning btn-xs" title="{% translate 'Edit Board' %}" data-toggle="collapse" data-target="#collapseEditBoard-{{ board.board_obj.pk }}" aria-expanded="false" aria-controls="collapseEditBoard-{{ board.board_obj.pk }}">
                                                                <i class="fas fa-pencil-alt"></i>
                                                            </button>

                                                            <button class="btn btn-danger btn-xs"title="{% translate 'Delete Board' %}">
                                                                <i class="far fa-trash-alt"></i>
                                                            </button>
                                                        </div>
                                                    </div>

                                                    <div class="collapse" id="collapseEditBoard-{{ board.board_obj.pk }}" style="margin-top: 1rem;">
                                                        <div class="well">
                                                            <p>
                                                                {% translate "Changing the name of this board does not change its URL part. This will remain the same to not break any possible links into this board." %}
                                                            </p>

                                                            <form action="{% url 'aa_forum:admin_board_edit' category.category_obj.pk board.board_obj.pk %}" method="post">
                                                                <fieldset>
                                                                    {% csrf_token %}

                                                                    {{ board.board_edit_form|bootstrap }}

                                                                    <div class="form-group aa-forum-form-new-category text-right clearfix">
                                                                        <button class="btn btn-primary btn-sm" type="submit">{% translate 'Change Board' %}</button>
                                                                    </div>
                                                                </fieldset>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </li>
                                            {% endfor %}
                                        </ul>

                                        <script type="application/javascript">
                                            categoriesWithBoards.push('#boards-sortable-category-{{ category.category_obj.pk }}')
                                        </script>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}
</div>
